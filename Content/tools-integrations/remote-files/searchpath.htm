<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title>Use Searchpath with S3</title>
        <meta rel="canonical" href="https://docs.liquibase.com/tools-integrations/remote-files/searchpath.html" />
        <meta name="description" content="Use searchpath S3 with Liquibase. Searchpath is combined with the relative path of the fileâ€™s property to find files stored remotely on S3." />
    </head>
    <body>
        <h1>Use <code>search-path</code> with S3 <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_pro.flsnp" /></h1>
        <p>The <MadCap:xref href="../../concepts/changelogs/how-liquibase-finds-files.htm">searchpath</MadCap:xref> property is used to store the base elements of the path to <MadCap:variable name="General.changelog" /> files or snapshot files. <MadCap:variable name="General.changelog" /> files (and a few others) cannot be specified by an absolute path on the file property itself, so the search path is combined with the relative path of the file's property to <b>find</b> these files stored remotely on S3. <code>Search-path</code> can be set in the CLI, within the <code><MadCap:variable name="General.liquiPropFile" /></code> file, as an environment variable, or any other standard method for setting a property.</p>
        <h2>Use <code>search-path</code> to locate <MadCap:variable name="General.changelog" />s on S3</h2>
        <p>Both an S3 directory in the search path and a relative path are required to find <MadCap:variable name="General.changelog" /> files or snapshot files. Follow the steps below to learn how to set both of these and configure them.</p>
        <ol>
            <li>Determine the S3 paths necessary to locate the <MadCap:variable name="General.changelog" /> to use. If <MadCap:variable name="General.changelog" /> resources, such as additional included <MadCap:variable name="General.changelog" />s or SQL files are in a different S3 path, you will have multiple items in the <code>search-path</code>.<br /><br />For example, if a <MadCap:variable name="General.changelog" /> file is in S3 at <code>s3://myS3Bucket/demo</code> and the SQL files referenced by the <MadCap:variable name="General.changelog" /> are in <code>s3://myS3Bucket/demo/sqlFiles</code>, your search path is <code>s3://myS3Bucket/demo,s3://myS3Bucket/demo/sqlFiles</code>.</li>
            <li>
                <p>To execute <MadCap:variable name="General.Liquibase" /> commands that read <MadCap:variable name="General.changelog" />s located in S3, provide the <code>search-path</code> and a filename or relative path to the file.</p>
                <p>Example 1: <code>update-sql</code> command using a <MadCap:variable name="General.changelog" /> file in S3:</p><pre xml:space="preserve"><code class="language-text">liquibase --search-path s3://myS3Bucket/demo,s3://myS3Bucket/demo/sqlFiles update-sql --changelog-file example-changelog.sql
liquibase --search-path=s3://myS3bucket/demo --changelog=example-changelog.sql</code></pre>
                <p>Example 2: <code>update-sql</code> command using a relative path to the <MadCap:variable name="General.changelog" /> file in S3:</p>
                <p>If the <MadCap:variable name="General.changelog" /> is located in subdirectory like <code>s3://myS3Bucket/demo/changelogs</code>, when you use the <code>search-path</code> defined in the previous example, then you must specify the relative path to the <MadCap:variable name="General.changelog" />:</p><pre xml:space="preserve"><code class="language-text">liquibase --search-path s3://myS3Bucket/demo,s3://myS3Bucket/demo/sqlFiles update-sql --changelog-file changelogs/example-changelog.sql</code></pre>
            </li>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">Paths to <MadCap:variable name="General.changelog" />s must always be relative to preserve integrity of the <MadCap:variable name="General.Liquibase" /> <MadCap:variable name="General.databasechangelog" /> tracking table.</p>
        </ol>
        <h2><code>Search-path</code> rules</h2>
        <p>Below are all of the rules that apply to <code>search-path</code>. Review the example use cases and instructions to ensure it is the right avenue for your project.</p>
        <h3>Multiple searchpaths</h3>
        <p>If <code>search-path</code> is set, it is used and <MadCap:variable name="General.Liquibase" /> will not look in other locations for <MadCap:variable name="General.changelog" /> or snapshot files. Therefore, if some necessary files are located on S3 and some are local, both locations are required in the search path.</p>
        <ul>
            <li>When not specifically configured, by default <code>search-path</code> looks for <MadCap:variable name="General.changelog" />s in the current working directory.</li>
            <li>When <code>search-path</code> is configured, only the locations explicitly defined in <code>search-path</code> are used to locate <MadCap:variable name="General.changelog" />s.</li>
            <li>Multiple <code>search-path</code> locations are comma-separated and processed in order. For example:<pre><code class="language-text">search-path s3://myS3Bucket/demo,C:\Users\Me\demo</code></pre></li>
            <li>
                <p>If multiple <code>search-path</code> locations are specified, <MadCap:variable name="General.Liquibase" /> may find two or more changelog files with the same name. To determine how <MadCap:variable name="General.Liquibase" /> behaves in this case, see the Duplicate File Mode section below.</p>
                <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">If the <MadCap:variable name="General.changelog" /> references resource files in multiple directories, it may be easier to define the <code>search-path</code> as an environment variable. This prevents the <code>search-path</code> property from making the command line unreadable. The <code>search-path</code> environment variable is <code>LIQUIBASE_SEARCH_PATH</code>.</p>
            </li>
        </ul>
        <p>Multiple <code>search-path</code> locations example:</p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;"><code>s3://mybucket/path</code> is the first location and <code>.localfiles</code> is the second location that <code>search-path</code> will find the files.</p><pre><code class="language-text">--search-path=s3://mybucket/path,.localfiles</code></pre>
        <h3>Duplicate File Mode</h3>
        <p>The <MadCap:xref href="../../parameters/command-parameters.htm">duplicate-file-mode</MadCap:xref> property determines how <MadCap:variable name="General.Liquibase" /> behaves when multiple <MadCap:variable name="General.changelog" />s are found in the multiple locations specified in the <code>search-path</code> property. By default, an <code>ERROR</code> will be thrown, but <code>duplicate-file-mode</code> can be set to <code>WARN</code> instead. In which case, the command will continue, using the first <MadCap:variable name="General.changelog" /> file found in a sequential processing of <code>search-path</code> locations.</p>
        <h4>Error Response</h4>
        <p>The <code>ERROR</code> response states two files are found and <MadCap:variable name="General.Liquibase" /> will not use either file. It will then suggest you rename the file or correct your <code>search-path</code>, and then re-run the command.</p>
        <p><b>Example: Default behavior of duplicate-file-mode when <code>changelog.xml</code> is located in two <code>search-path</code> directories.</b>
        </p>
        <p>In this example, a <MadCap:variable name="General.changelog" /> named <code>changelog.xml</code> is located in both <code>s3://myS3bucket/demo</code> and in <code>s3://myS3Bucket/demo2</code>.</p><pre><code class="language-text">liquibase --seach-path s3://myS3Bucket/demo,s3://myS3Bucket/demo2 update-sql --changelog-file changelog.xml</code></pre>
        <p><MadCap:variable name="General.Liquibase" /> console output shows an error and does not execute the <code>update-sql</code> command.</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: JavaScript;">Unexpected error running Liquibase: Error changelog.xml
  - Caused by: Found 2 files with the path 'changelog.xml':
    - s3://myS3Bucket/demo/changelog.xml
    - s3://myS3Bucket/demo2/changelog.xml
  Search Path:
    - s3://myS3Bucket/demo/changelog.xml
    - s3://myS3Bucket/demo2/changelog.xml
  You can limit the search path to remove duplicates with the liquibase.searchPath setting. Or, if you KNOW these are the exact same file you can set liquibase.duplicateFileMode=WARN.</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p><code>liquibase --duplicate-file-mode ERROR --seach-path s3://myS3Bucket/demo,s3://myS3Bucket/demo2 update-sql --changelog-file changelog.xml</code> results in <code>update-sql</code> exiting with an <code>ERROR</code> that duplicate <code>changelog.xml</code> file was located.</p>
        <p style="font-weight: bold;">Example:&#160;Behavior when duplicate-file-mode set to <code>ERROR</code> and <code>changelog.xml</code> is located in two <code>search-path</code> directories</p>
        <p>Although the default for <code>duplicate-file-mode</code> is <code>ERROR</code>, you can explicitly configure the setting to throw an error. In this example, a <MadCap:variable name="General.changelog" /> named <code>changelog.xml</code> is located in both <code>s3://myS3bucket/demo</code> and in <code>s3://myS3Bucket/demo2</code>.</p>
        <p><code>liquibase --duplicate-file-mode ERROR --seach-path s3://myS3Bucket/demo,s3://myS3Bucket/demo2 update-sql --changelog-file changelog.xml</code>
        </p>
        <p><MadCap:variable name="General.Liquibase" /> console output shows an error and does not execute the <code>update-sql</code> command.</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: JavaScript;">Unexpected error running Liquibase: Error changelog.xml
  - Caused by: Found 2 files with the path 'changelog.xml':
    - s3://myS3Bucket/demo/changelog.xml
    - s3://myS3Bucket/demo2/changelog.xml
  Search Path:
    - s3://myS3Bucket/demo/changelog.xml
    - s3://myS3Bucket/demo2/changelog.xml
  You can limit the search path to remove duplicates with the liquibase.searchPath setting. Or, if you KNOW these are the exact same file you can set liquibase.duplicateFileMode=WARN.</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <h4>Warn response</h4>
        <p>The <code>WARN</code> response states two files are found and it will automatically use the first file found.</p>
        <p><b>Example: Behavior when duplicate-file-mode set to <code>WARN</code> and <code>changelog.xml</code> is located in two <code>search-path</code> directories.</b>
        </p>
        <p>To explicitly ignore duplicate changelogs in the <code>search-path</code>, configure <code>duplicate-file-mode</code> to <code>WARN</code>. In this example, a <MadCap:variable name="General.changelog" /> named <code>changelog.xml</code> is located in both <code>s3://myS3bucket/demo</code> and in <code>s3://myS3Bucket/demo2</code>.</p><pre><code class="language-text">liquibase --duplicate-file-mode WARN --seach-path s3://myS3Bucket/demo,s3://myS3Bucket/demo2 update-sql --changelog-file changelog.xml</code></pre>
        <p><MadCap:variable name="General.Liquibase" /> console output shows a warning. The <code>update-sql</code> command is executed using the <MadCap:variable name="General.changelog" /> in <code>s3://myS3Bucket/demo</code>.</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: JavaScript;">Found 2 files with the path 'changelog.xml':
- s3://myS3Bucket/demo/changelog.xml
- s3://myS3Bucket/demo2/changelog.xml
Search Path:
- s3://myS3Bucket/demo/changelog.xml
- s3://myS3Bucket/demo2/changelog.xml
You can limit the search path to remove duplicates with the liquibase.searchPath setting.
To fail when duplicates are found, set liquibase.duplicateFileMode=ERROR
Choosing: s3://myS3Bucket/demo/changelog.xml</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
    </body>
</html>