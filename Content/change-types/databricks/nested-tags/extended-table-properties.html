<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:searchable="False">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <link rel="canonical" href="https://docs.liquibase.com/change-types/databricks/nested-tags/extended-table-properties.html" />
        <meta name="description" content="Reference information for the extendedTableProperties tag. extendedTableProperties is a tag in the Liquibase Open Source Databricks extension that lets you specify additional properties on a table you're creating." />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <h1 id="alter-cluster"><code>extendedTableProperties</code>
        </h1>
        <p><code>extendedTableProperties</code> is a tag in the <a href="../../../start/tutorials/databricks/home.htm"><MadCap:variable name="General.LBCommunity" /> Databricks extension</a> that lets you specify additional properties on a table you're creating. It is a sub-tag of the Liquibase&#160;<code><MadCap:xref href="../../create-table.html">createTable</MadCap:xref></code>&#160;<MadCap:variable name="General.changetypes" />.</p>
        <p>To alter existing properties on a table, see <code><MadCap:xref href="../alter-table-properties.html">alterTableProperties</MadCap:xref></code>.</p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">To specify additional properties on a view, you can use <code>tblProperties</code> directly on the Liquibase&#160;<code><MadCap:xref href="../../create-view.html">createView</MadCap:xref></code>&#160;<MadCap:variable name="General.changetypes" /> instead of on the <code>extendedTableProperties</code> sub-tag. To alter existing properties on a view, see <code><MadCap:xref href="../alter-view-properties.html">alterViewProperties</MadCap:xref></code>.</p>
        <h2>Uses</h2>
        <p>You can use this <MadCap:variable name="General.changetypes" /> to specify additional properties about a table you're creating. You can create a table in your database using <code>createTable</code> and then specify Databricks-specific behavior using <code>extendedTableProperties</code>. Also, Liquibase does not have built-in fields for every possible key you can use in Databricks, so the <code>tblProperties</code>&#160;<MadCap:variable name="General.Param/Attribute" /> lets you specify your keys freely.</p>
        <h2>Run <code>extendedTableProperties</code></h2>
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/note/change-type-databricks-sub-tag-create-table.flsnp" />
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/text/change-type-run-syntax.flsnp" />
        <h2 id="available-attributes">Available <MadCap:variable name="General.Param/Attribute" />s</h2>
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/note/database-required-attributes.flsnp" />
        <table>
            <col />
            <col />
            <col />
            <col />
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Requirement</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>clusterColumns</code>
                    </td>
                    <td>String</td>
                    <td>
                        <p>The columns to cluster. Clusters are an alternative to partitions. The column order does not matter. Using clusters can help optimize performance for some database queries, such as read operations on some table filters.  Databricks recommends using clustering for all new tables you create. For more information, see <a href="https://docs.databricks.com/en/delta/clustering.html">Use liquid clustering for Delta tables</a> and <a href="https://docs.databricks.com/en/sql/language-manual/sql-ref-syntax-ddl-cluster-by.html">CLUSTER&#160;BY clause (TABLE)</a>.</p>
                        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/note/change-type-databricks-cluster-columns-partition-columns.flsnp" />
                        <p class="tip" MadCap:autonum="&lt;b&gt;Tip: &lt;/b&gt;">Databricks does not allow you to drop tables containing clustered columns. You must use <code><MadCap:xref href="../alter-cluster.html">alterCluster</MadCap:xref></code> to remove clustering before you can drop the table.</p>
                    </td>
                    <td>Optional</td>
                </tr>
                <tr>
                    <td><code>tableFormat</code>
                    </td>
                    <td>String</td>
                    <td>The format of the table to create in Databricks. Valid values are:&#160;<code>avro</code>, <code>binaryfile</code>, <code>csv</code>, <code>delta</code>, <code>json</code>, <code>orc</code>, <code>parquet</code>, and <code>text</code>. For more information, see <a href="https://docs.databricks.com/en/tables/tables.html">What is a table?</a> and <a href="https://docs.databricks.com/en/sql/language-manual/sql-ref-syntax-ddl-create-table-using.html">CREATE&#160;TABLE [USING]</a>. <b>Default:&#160;<code>delta</code></b>.</td>
                    <td>Optional</td>
                </tr>
                <tr>
                    <td><code>tableLocation</code>
                    </td>
                    <td>String</td>
                    <td>The file path to the external location where you want to create the table. You must first create an external location for your table in Databricks. Using the Databricks interface, you can do this at <b>Catalog -&gt; + ["add" icon] -&gt; Add an external location</b>. For more information, see <a href="https://docs.databricks.com/en/sql/language-manual/sql-ref-external-locations.html">External locations</a> and <a href="https://docs.databricks.com/en/connect/unity-catalog/external-locations.html">Create an external location to connect cloud storage to Databricks</a>.</td>
                    <td>Optional</td>
                </tr>
                <tr>
                    <td><code>tblProperties</code>
                    </td>
                    <td>String</td>
                    <td>
                        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/def/attributes/change-types/databricks/change-type-tbl-properties.flsnp" />
                    </td>
                    <td>Optional</td>
                </tr>
                <tr>
                    <td><code>partitionColumns</code>
                    </td>
                    <td>String</td>
                    <td>
                        <p>The columns to partition. The column order does not matter. Using partitions can speed up table queries and data manipulation. Partitions are an alternative to clusters. For more information, see <a href="https://docs.databricks.com/en/sql/language-manual/sql-ref-partition.html">Partitions</a> and <a href="https://docs.databricks.com/en/tables/partitions.html">When to partition tables on Databricks</a>.</p>
                        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/note/change-type-databricks-cluster-columns-partition-columns.flsnp" />
                    </td>
                    <td>Optional</td>
                </tr>
            </tbody>
        </table>
        <h2 id="examples">Examples</h2>
        <div class="js-tabs">
            <ul class="js-tablist" data-hx="h3">
                <li class="js-tablist__item"><a href="#yaml_example" id="label_yaml_example" class="js-tablist__link">YAML example</a>
                </li>
                <li class="js-tablist__item"><a href="#json_example" id="label_json_example" class="js-tablist__link">JSON example</a>
                </li>
                <li class="js-tablist__item"><a href="#xml_example" id="label_xml_example" class="js-tablist__link">XML example</a>
                </li>
            </ul>
            <div id="yaml_example" class="js-tabcontent">
                <p>With clustered columns:</p><pre xml:space="preserve"><code class="language-yaml">databaseChangeLog:
  - changeSet:
      id: 1
      author: your.name
      changes:
        - createTable:
            tableName: test_table_properties
            columns:
              - column:
                  name: id
                  type: int
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: some_column
                  type: int
            extendedTableProperties:
              clusterColumns: id, some_column
              tableFormat: delta
              tableLocation: s3://databricks-external-folder/test_table_properties
              tblProperties: 'this.is.my.key'=12,'this.is.my.key2'=true
      rollback:
        dropTable:
          tableName: test_table_properties</code></pre>
                <p>With partitioned columns:</p><pre xml:space="preserve"><code class="language-yaml">databaseChangeLog:
  - changeSet:
      id: 1
      author: your.name
      changes:
        - createTable:
            tableName: test_table_properties
            columns:
              - column:
                  name: id
                  type: int
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: some_column
                  type: int
              - column
                  name: some_other_column
                  type: int
            extendedTableProperties:
              partitionColumns: id, some_column
              tableFormat: delta
              tableLocation: s3://databricks-external-folder/test_table_properties
              tblProperties: 'this.is.my.key'=12,'this.is.my.key2'=true
      rollback:
        dropTable:
          tableName: test_table_properties</code></pre>
            </div>
            <div id="json_example" class="js-tabcontent">
                <p>With clustered columns:</p><pre xml:space="preserve"><code class="language-json">{
  "databaseChangeLog": [
    {
      "changeSet": {
        "id": "1",
        "author": "your.name",
        "changes": [
          {
            "createTable": {
              "tableName": "test_table_properties",
              "columns": [
                {
                  "column": {
                    "name": "id",
                    "type": "int",
                    "constraints": {
                      "primaryKey": "true",
                      "nullable": "false"
                    }
                  }
                },
                {
                  "column": {
                    "name": "some_column",
                    "type": "int"
                  }
                }
              ],
              "extendedTableProperties": {
                "clusterColumns": "id, some_column",
                "tableFormat": "delta",
                "tableLocation": "s3://databricks-external-folder/test_table_properties",
                "tblProperties": "'this.is.my.key'=12,'this.is.my.key2'=true"
              }
            }
          }
        ],
        "rollback": [
          {
            "dropTable": {
              "tableName": "test_table_properties"
            }
          }
        ]
      }
    }
  ]
}</code></pre>
                <p>With partitioned columns:</p><pre xml:space="preserve"><code class="language-json">{
  "databaseChangeLog": [
    {
      "changeSet": {
        "id": "1",
        "author": "your.name",
        "changes": [
          {
            "createTable": {
              "tableName": "test_table_properties",
              "columns": [
                {
                  "column": {
                    "name": "id",
                    "type": "int",
                    "constraints": {
                      "primaryKey": "true",
                      "nullable": "false"
                    }
                  }
                },
                {
                  "column": {
                    "name": "some_column",
                    "type": "int"
                  }
                },
                {
                  "column": {
                    "name": "some_other_column",
                    "type": "int"
                  }
                }
              ],
              "extendedTableProperties": {
                "partitionColumns": "id, some_column",
                "tableFormat": "delta",
                "tableLocation": "s3://databricks-external-folder/test_table_properties",
                "tblProperties": "'this.is.my.key'=12,'this.is.my.key2'=true"
              }
            }
          }
        ],
        "rollback": [
          {
            "dropTable": {
              "tableName": "test_table_properties"
            }
          }
        ]
      }
    }
  ]
}</code></pre>
            </div>
            <div id="xml_example" class="js-tabcontent">
                <p>With clustered columns:</p><pre xml:space="preserve"><code class="language-xml"><MadCap:snippetText src="../../../Z_Resources/Snippets/code/liquibase-xsd-xml-changelog-databricks.flsnp" />

    &lt;changeSet id="1" author="your.name"&gt;
        &lt;createTable tableName="test_table_properties"&gt;
            &lt;column name="id" type="int" &gt;
                &lt;constraints primaryKey="true" nullable="false"/&gt;
            &lt;/column&gt;
            &lt;column name="some_column" type="int"/&gt;

            &lt;databricks:extendedTableProperties clusterColumns="id, some_column"
                                                tableFormat="delta"
                                                tableLocation="s3://databricks-external-folder/test_table_properties"
                                                tblProperties="'this.is.my.key'=12,'this.is.my.key2'=true"/&gt;
        &lt;/createTable&gt;

        &lt;rollback&gt;
            &lt;dropTable tableName="test_table_properties"/&gt;
        &lt;/rollback&gt;
    &lt;/changeSet&gt;

&lt;/databaseChangeLog&gt;</code></pre>
                <p>With partitioned columns:</p><pre xml:space="preserve"><code class="language-xml"><MadCap:snippetText src="../../../Z_Resources/Snippets/code/liquibase-xsd-xml-changelog-databricks.flsnp" />

    &lt;changeSet id="1" author="your.name"&gt;
        &lt;createTable tableName="test_table_properties"&gt;
            &lt;column name="id" type="int" &gt;
                &lt;constraints primaryKey="true" nullable="false"/&gt;
            &lt;/column&gt;
            &lt;column name="some_column" type="int"/&gt;
            &lt;column name="some_other_column" type="int"/&gt;

            &lt;databricks:extendedTableProperties partitionColumns="id, some_column"
                                                tableFormat="delta"
                                                tableLocation="s3://databricks-external-folder/test_table_properties"
                                                tblProperties="'this.is.my.key'=12,'this.is.my.key2'=true"/&gt;
        &lt;/createTable&gt;

        &lt;rollback&gt;
            &lt;dropTable tableName="test_table_properties"/&gt;
        &lt;/rollback&gt;
    &lt;/changeSet&gt;

&lt;/databaseChangeLog&gt;</code></pre>
            </div>
        </div>
        <h2>Troubleshooting</h2>
        <h3>Clustered and partitioned columns collision</h3>
        <p>If you specify values for <code>clusterColumns</code> and <code>partitionColumns</code> on the same table, Liquibase throws this error:</p><pre><code>Databricks does not support CLUSTER columns AND PARTITION BY columns, please pick one.</code></pre>
        <p>Instead, you must specify either <code>clusterColumns</code> or <code>partitionColumns</code>, but not both.</p>
        <h3>Extended table properties double initialization</h3>
        <p>It is technically possible to specify some Databricks-specific <MadCap:variable name="General.Param/Attribute" />s directly in <code>createTable</code> instead of in <code>extendedTableProperties</code>. <b>This is not a best practice.</b> If you specify Databricks-specific <MadCap:variable name="General.Param/Attribute" />s in both places, Liquibase throws this error:</p><pre><code>Double initialization of extended table properties is not allowed. Please avoid using both EXT createTable attributes and Databricks specific extendedTableProperties element. Element databricks:extendedTableProperties is preferred way to set databricks specific configurations.</code></pre>
        <p>Instead, you must specify all Databricks-specific <MadCap:variable name="General.Param/Attribute" />s in <code>extendedTableProperties</code>.</p>
        <h3>All columns in table are partitioned</h3>
        <p>If you try to create a partition using every column in a table, Databricks throws an <a href="https://docs.databricks.com/en/error-messages/sqlstates.html#class-kd-datasource-specific-errors">error</a> like:</p><pre><code>Cannot use all columns for partition columns.</code></pre><pre><code>Data written into Delta needs to contain at least one non-partitioned column.</code></pre>
        <p>To resolve this, ensure that your table contains at least column that does not have a partition. For more information, see <a href="https://docs.databricks.com/en/tables/partitions.html">When to partition tables on Databricks</a>.</p>
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/text/change-type-databricks-database-support-nested-tag.flsnp" />
        <h2>Related links</h2>
        <ul>
            <li><a href="https://docs.databricks.com/en/sql/language-manual/sql-ref-syntax-ddl-tblproperties.html">Databricks SQL&#160;Reference:&#160;Table properties and table options</a>
            </li>
            <li><a href="https://docs.databricks.com/en/delta/table-properties.html">Databricks: Delta table properties reference</a>
            </li>
        </ul>
    </body>
</html>