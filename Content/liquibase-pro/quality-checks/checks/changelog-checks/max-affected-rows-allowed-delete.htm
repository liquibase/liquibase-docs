<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <link rel="canonical" href="https://docs.liquibase.com/liquibase-pro/quality-checks/checks/changelog-checks/max-affected-rows-allowed-delete.html" />
        <meta name="description" content="This check triggers when the Max Affected Rows Allowed value is exceeded by the number of rows deleted by a SQL statement. The SQL statement is executed against the database and then rolled back." />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <p>
            <MadCap:snippetText src="../../../../Z_Resources/Snippets/images/icon-pro-top.flsnp" />
        </p>
        <h1>maxAffectedRowsAllowedDelete</h1>
        <p>This check triggers when the number of rows a SQL statement <b>deletes</b> exceeds the value of <code>MaxAffectedRowsAllowed</code>. The SQL statement is executed against the database and then rolled back.</p>
        <h2>Uses</h2>
        <p>Use this check to prevent statements from being deleted from your database if more than a specified number of rows are affected by that statement.</p>
        <h2>Run the maxAffectedRowsAllowedDelete check</h2>
        <p>To run the <code class="language-text">maxAffectedRowsAllowedDelete</code> check, ensure you have a  <MadCap:variable name="General.LBPro" /> license, a valid <code class="language-text">url</code> property that points to a live JDBC connection or a snapshot, and that the <MadCap:xref href="../../../../commands/quality-checks/command-parameters/checks-scope.htm">checks-scope</MadCap:xref> property includes the <code><MadCap:variable name="General.changelog" /></code>. The <MadCap:xref href="../../../../commands/quality-checks/command-parameters/checks-scope.htm">checks-scope</MadCap:xref> property is set in the default properties file, environment variable, or any standard method. Then check if any searchable object types match the supplied pattern. </p>
        <ol>
            <li>
                <p>To set the number of rows allowed you must customize the <code class="language-text">maxAffectedRowsAllowedDelete</code> check. Run the following command in the CLI:</p><pre>liquibase checks customize --check-name=maxAffectedRowsAllowedDelete</pre>
            </li>
            <li>
                <p>Set the Severity to return a code of 0-4 when triggered. (options: 'INFO'|0, 'MINOR'|1, 'MAJOR'|2, 'CRITICAL'|3, 'BLOCKER'|4)? [INFO]:</p>
            </li>
            <li>
                <p>Set the maximum affected rows in the CLI:</p><pre>MAX_ROWS (options: positive numeric value) [50]:</pre>
            </li>
            <li>
                <p>Set the message that displays when this check runs.</p><pre>Set 'MESSAGE' [&lt;AFFECTED_ROWS&gt; rows will be affected, which is more than the allowed '&lt;THRESHOLD&gt;' rows. The SQL statement is '&lt;STATEMENT&gt;' in '&lt;CHANGESET&gt;'.]:</pre>
            </li>
            <li>
                <p>Enable the <code class="language-text">maxAffectedRowsAllowedDelete</code> check by running the following command in the CLI:<pre><code class="language-text">liquibase checks enable --check-name=maxAffectedRowsAllowedDelete</code></pre></p>
            </li>
            <h3><code>MaxAffectedRowsAllowedDelete</code> Default message</h3>
            <p>The <code class="language-text">maxAffectedRowsAllowedDelete</code> default message is displayed below.</p><pre xml:space="preserve"><code class="language-text">Checks completed validation of the changelog and found the following issues:

Check Name:         Check Affected Rows Count (MAX_ROWS)
Changeset ID:       01
Changeset Filepath: delete.sql
Check Severity:     INFO (Return code: 0)
Message:            More than the allowed '50' rows will be affected by the SQL statement 
                    '&lt;SQL&#160;STATEMENT&gt;' in 
                    '&lt;CHANGESET&gt;'</code></pre>
        </ol>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot><code>liquibase checks enable --check-name=maxAffectedRowsAllowedDelete</code> example output</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre xml:space="preserve" style="text-align: left;"><code class="language-text">Check 'maxAffectedRowsAllowedDelete' has been enabled.
+-------------------------------------+------------+----------+----------+--------------------------------+--------------------------------+ 
| MaxAffectedRowsAllowedDelete        | changelog  | enabled | 0        | MAX_ROWS = 50                  | This checks triggers when the  |
|                                     |            |          |          | MESSAGE = &lt;AFFECTED_ROWS&gt; rows | Max Affected Rows Allowed      |
|                                     |            |          |          | will be affected, which is     | value is exceeded by the       |
|                                     |            |          |          | more than the allowed          | number of rows DELETED by a    |
|                                     |            |          |          | '&lt;THRESHOLD&gt;' rows. The SQL    | SQL statement.  The SQL        |
|                                     |            |          |          | statement is '&lt;STATEMENT&gt;' in  | statement is executed against  |
|                                     |            |          |          | '&lt;CHANGESET&gt;'.                 | the database, and then rolled  |
|                                     |            |          |          |                                | back.|
+-------------------------------------+------------+----------+----------+--------------------------------+--------------------------------+
| MaxAffectedRowsAllowedInsert        | changelog  | disabled | 0        | MAX_ROWS = 50                  | This checks triggers when the  |
|                                     |            |          |          | MESSAGE = &lt;AFFECTED_ROWS&gt; rows | Max Affected Rows Allowed      |
|                                     |            |          |          | will be affected, which is     | value is exceeded by the       |
|                                     |            |          |          | more than the allowed          | number of rows INSERTED by a   |
|                                     |            |          |          | '&lt;THRESHOLD&gt;' rows. The SQL    | SQL statement.  The SQL        |
|                                     |            |          |          | statement is '&lt;STATEMENT&gt;' in  | statement is executed against  |
|                                     |            |          |          | '&lt;CHANGESET&gt;'.                 | the database, and then rolled  |
|                                     |            |          |          |                                | back.|
+-------------------------------------+------------+----------+----------+--------------------------------+--------------------------------+
| MaxAffectedRowsAllowedUpdate        | changelog  | disabled  | 0        | MAX_ROWS = 50                  | This checks triggers when the  |
|                                     |            |          |          | MESSAGE = &lt;AFFECTED_ROWS&gt; rows | Max Affected Rows Allowed      |
|                                     |            |          |          | will be affected, which is     | value is exceeded by the       |
|                                     |            |          |          | more than the allowed          | number of rows UPDATED by a    |
|                                     |            |          |          | '&lt;THRESHOLD&gt;' rows. The SQL    | SQL statement.  The SQL        |
|                                     |            |          |          | statement is '&lt;STATEMENT&gt;' in  | statement is executed against  |
|                                     |            |          |          | '&lt;CHANGESET&gt;'.                 | the database, and then rolled  |
|                                     |            |          |          |                                | back.|
+-------------------------------------+------------+----------+----------+--------------------------------+--------------------------------+
Liquibase command 'checks enable' was executed successfully.</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
    </body>
</html>