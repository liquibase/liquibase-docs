<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <meta rel="canonical" href="https://docs.liquibase.com/start/tutorials/mongodb-pro.html" />
        <meta name="description" content="The MongoDB Pro Extension streamlines the workflow for MongoDB users." />
    </head>
    <body>
        <h1>Using <MadCap:variable name="General.Liquibase" /> with the MongoDB Pro Extension</h1>
        <p>
            <MadCap:snippetText src="../../Z_Resources/Snippets/images/icon-pro-top.flsnp" />
        </p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">The MongoDB Pro Extension requires <MadCap:variable name="General.Liquibase" /> 4.20+. It is only available to <MadCap:variable name="General.LBPro" /> users. This extension requires Java 11.</p>
        <p>The MongoDB&#160;Pro extension streamlines the workflow for MongoDB users. It allows you to use MongoDB's native language in <MadCap:variable name="General.changeset" />s and <MadCap:variable name="General.changetypes" />s. All of this is possible because  MongoDB&#160;Shell (mongosh) is compatible with <MadCap:variable name="General.LBPro" />.  MongoDB also supports  Targeted Rollback, Flows, and <MadCap:variable name="General.changelog" />-level quality checks with <MadCap:variable name="General.LBPro" />. Learn the details and how to implement this functionality below.</p>
        <p>This guide is intended for use with MongoDB&#160;products and services provided directly by MongoDB, Inc. This includes MongoDB Atlas, MongoDB Enterprise Server, and MongoDB Community Server. It does not imply support for third-party clones or emulations of Mongo.</p>
        <h2>Features</h2>
        <p>Some <MadCap:variable name="General.Liquibase" /> functionality is different with the MongoDB Pro Extension than with other databases:<br /></p>
        <ul>
            <li>As of <MadCap:variable name="General.LBPro" /> 4.20.1, JSON&#160;and YAML&#160;<MadCap:variable name="General.changelog" />s are supported along with the legacy support of XML <MadCap:variable name="General.changelog" />s.</li>
            <li>MongoDB is a NoSQL database, which means you are unable to use any commands that generate SQL output. Learn more about <MadCap:xref href="../../commands/home.htm">[%=General.Liquibase%] Commands</MadCap:xref> here.<ul><li>Rollback commands are supported except for commands that generate SQL output.</li><li>Change tracking commands are supported except for commands that generate SQL output.</li></ul></li>
            <li>Quality Check functionality that works with the MongoDB&#160;Pro Extension is limited to checks targeting the <MadCap:variable name="General.changelog" /> scope. Learn more about <MadCap:xref href="../../commands/quality-checks/home.htm">Quality Checks</MadCap:xref> here. The pre-packaged Quality Check content currently relevant to MongoDB&#160;are these two items:<ul><li>Checks that focus on <MadCap:variable name="General.changeset" /> metadata, such as <MadCap:xref href="../../commands/quality-checks/checks/rollback-required.htm">RollbackRequired</MadCap:xref> and <MadCap:xref href="../../commands/quality-checks/checks/changeset-label-check.htm">ChangesetLabelCheck</MadCap:xref>.</li><li>The generic regex-based check <MadCap:xref href="../../commands/quality-checks/checks/sql-user-defined-pattern-check.htm">SqlUserDefinedPatternCheck</MadCap:xref>.<br /><p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">These quality checks work only if you have created your own from the regex template. <MadCap:variable name="General.Liquibase" /> uses the <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/util/regex/Pattern.html">java.util.regex</a> engine to match regular expressions.</p></li></ul></li>
            <li><code>mongo</code> and <code>mongoFile</code> are the two new <MadCap:variable name="General.changetypes" />s available to <MadCap:variable name="General.Liquibase" />. They require a user to configure the native executor, Mongo Shell (mongosh), prior to use.</li>
        </ul>
        <h2>Verified versions</h2>
        <table style="width: 100%;">
            <col />
            <col />
            <col />
            <col />
            <thead>
                <tr>
                    <th>MongoDB Tested Versions</th>
                    <th>MongoDB Shell Tested Versions</th>
                    <th><MadCap:variable name="General.LBPro" /> Compatible Version</th>
                    <th>Supported Auth mechanisms</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>4.4.x</td>
                    <td>1.6.x<br />1.7.x<br />1.8.x - Recommended</td>
                    <td>4.19.0 and later</td>
                    <td>SCRAM &amp; x.509</td>
                </tr>
                <tr>
                    <td>5.x</td>
                    <td>1.6.x<br />1.7.x<br />1.8.x - Recommended</td>
                    <td>4.19.0 and later</td>
                    <td>SCRAM &amp; x.509</td>
                </tr>
                <tr>
                    <td>6.x</td>
                    <td>1.6.x<br />1.7.x<br />1.8.x - Recommended</td>
                    <td>4.19.0 and later</td>
                    <td>SCRAM &amp; x.509</td>
                </tr>
            </tbody>
        </table>
        <p class="tip" MadCap:autonum="&lt;b&gt;Tip: &lt;/b&gt;">LDAP and Kerberos Authentication are not supported at this time. Learn more about MongoDB&#160;Authentication here: <a href="https://www.mongodb.com/docs/v6.0/core/authentication/">authentication</a><br /></p>
        <h3>Command support</h3>
        <p>MongoDB does not support&#160;the database inspection commands family  or the <code>*sql</code> command variants (such as <code>update-sql</code> and <code>changelog-sync-sql</code>).</p>
        <p><MadCap:variable name="General.LBPro" /> Quality Checks have limited support. Changelog-scoped quality checks are supported <b>as long as they are not SQL-specific or relational-specific</b>. Database-scoped quality checks are not supported because they are database-specific.</p>
        <p>Supported quality checks:<br /><ul><li><code>RollbackRequired</code></li><li><code>ChangesetContextCheck</code><br /></li><li><code>ChangesetCommentCheck</code></li><li><code>ChangesetLabelCheck</code></li><li><code>RequiredChangesetDisUUID</code></li><li><code>SqlUserDefinedPatternCheck</code></li></ul><h2>Verification level</h2><MadCap:snippetBlock src="../../Z_Resources/Snippets/def/database-verification-levels.flsnp" /><MadCap:snippetBlock src="../../Z_Resources/Snippets/def/database-verification-level-foundational.flsnp" /></p>
        <h2>Prerequisites</h2>
        <MadCap:snippetBlock src="../../Z_Resources/Snippets/text/database-tutorials/database-prerequisites.flsnp" />
        <h2>Implement the MongoDB Pro extension</h2>
        <ol>
            <li>If you have the current open source MongoDB&#160;version installed, remove it and the associated drivers from your machine.</li>
            <li>Ensure that your <MadCap:xref href="mongodb-pro-user-roles.htm">MongoDB Pro Extension User Roles</MadCap:xref> are established before continuing.</li>
            <li><a href="https://www.mongodb.com/try/download/shell">Download and Install mongosh</a> if it is not already installed on your machine.</li>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;"><code>mongosh</code> is mandatory to use MongoDB&#160;with <MadCap:variable name="General.LBPro" /> and it must be accessible to <MadCap:variable name="General.Liquibase" />. We recommend that mongosh is in the system <code>PATH</code>&#160;environment variable. If it is not, that location of mongosh must be manually specified in the <code>liquibase.mongosh.conf</code> file.</p>
            <li><a href="https://www.oracle.com/java/technologies/downloads/#java11">Download Java 11</a>. The MongoDB&#160;Pro Extension requires it.</li>
            <p class="tip" MadCap:autonum="&lt;b&gt;Tip: &lt;/b&gt;">Java 11 may already be present on your machine if you used the installer to install <MadCap:variable name="General.Liquibase" />. We recommend installing <MadCap:variable name="General.Liquibase" /> with Java 11 with the <a href="https://github.com/liquibase/liquibase/releases">installer asset available on GitHub</a>.</p>
            <li><a href="https://mvnrepository.com/artifact/org.liquibase.ext/liquibase-commercial-mongodb/1.0.0">Download the JAR file</a> that contains the MongoDB&#160;Pro Extension and drivers from Maven Central. <MadCap:snippetText src="../../Z_Resources/Snippets/text/database-tutorials/database-driver.flsnp" MadCap:conditionTagExpression="include[database-driver.driver-manually-installed or database-driver.maven-jar-public]" /><pre xml:space="preserve"><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.liquibase.ext&lt;/groupId&gt;
    &lt;artifactId&gt;liquibase-commercial-mongodb&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre></li>
        </ol>
        <h2>Configure your TLS/SSL encrypted connection</h2>
        <p>If you are using TLS/SSL, configure the TLS/SSL encrypted connection for the MongoDB Pro extension.</p>
        <p class="tip" MadCap:autonum="&lt;b&gt;Tip: &lt;/b&gt;">This is only required if you are using TLS/SSL because it is active on your Mongo server or because  you are using MongoDB Atlas.</p>
        <ol>
            <li>Configure the MongoDB instance by first following <a href="https://www.mongodb.com/docs/manual/tutorial/configure-ssl/">Mongo's configuration guide</a>.</li>
            <li>Then verify that it works by following <a href="https://www.mongodb.com/docs/manual/tutorial/configure-ssl-clients/#connect-to-mongodb-instance-using-encryption--tls-options-">Mongo's verification guide</a>.</li>
            <li>Add the <code>--tlsCertificateKeyFile</code> certificate that is produced in the configuration step above to the Java keystore. The <code>--tlsCertificateKeyFile</code> specifies the <code>.pem</code> file that contains mongosh's certificate.</li>
            <p>On Linux:</p><pre><code class="language-text">sudo keytool -importcert -trustcacerts -file PATH_TO_CERT_FILE/mongodb-cert.crt -cacerts -storepass changeit -alias MongoDB</code></pre>
            <p>On Windows, open terminal in Administrator mode and run:</p><pre><code class="language-text">keytool -importcert -trustcacerts -file PATH_TO_CERT_FILE\\mongodb-cert.crt -cacerts -storepass changeit -alias mongodb</code></pre>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">The default password for keystore is <code>changeit</code>.</p>
            <li>
                <p>Add the <code>url</code> parameter to the CLI, <MadCap:variable name="General.liquiPropFile" /> file, or set it as an environment variable:</p>
                <p class="example" MadCap:autonum="&lt;b&gt;Example: &lt;/b&gt;"><MadCap:variable name="General.liquiPropFile" /> file:<br /><code>liquibase.command.url=mongodb+srv://&lt;hostname&gt;/&lt;database&gt;</code><br /><code>liquibase.command.url: mongodb://localhost:27017/lbcat?tls=true&amp;tlsCAFile=mongodb.pem</code><br /><br />Environment variable:<br /><code>LIQUIBASE_COMMAND_URL=mongodb+srv://&lt;hostname&gt;/&lt;database&gt;</code><br /><code>LIQUIBASE_COMMAND_URL: mongodb://localhost:27017/lbcat?tls=true&amp;tlsCAFile=mongodb.pem</code><br /></p>
                <p>If you are using a Java keystore that is not the default, you must add the necessary environment variables before running <MadCap:variable name="General.Liquibase" /> commands.</p>
                <p>On Linux:</p><pre><code class="language-text">export JAVA_OPTS="-Djavax.net.ssl.keyStore=PATH_TO_KEYSTORE/cacerts -Djavax.net.ssl.keyStorePassword=PASSWORD"</code></pre>
                <p>On Windows:</p><pre><code class="language-text">set JAVA_OPTS=-Djavax.net.ssl.keyStore="PATH_TO_KEYSTORE\\cacerts" -Djavax.net.ssl.keyStorePassword=PASSWORD</code></pre>
                <p>Do not use <code>setx</code> as it adds <code>keyStorePassword</code> to system environment variables.</p>
            </li>
        </ol>
        <h3>Troubleshooting errors</h3>
        <p>After connecting <MadCap:variable name="General.Liquibase" /> with the MongoDB&#160;Pro Extension, you may come across an error that states:</p><pre><code class="language-text">Error: Could not find or load main class Files\\Java\\{jdk-version}.security.cacerts Caused by: java.lang.ClassNotFoundException: Files\\Java\\{jdk-version}.security.cacerts</code></pre>
        <p>This means that <MadCap:variable name="General.LBPro" /> is struggling to find the certification file. To resolve the issue, run the following command in the CLI:</p>
        <p>On Windows:</p><pre><code class="language-text">set JAVA_OPTS=-Djavax.net.ssl.keyStore="%JAVA_HOME%\\lib\\security\\cacerts"</code></pre>
        <p>On Linux:</p><pre><code class="language-text">export JAVA_OPTS=-Djavax.net.ssl.keyStore=$JAVA_HOME/lib/security/cacerts</code></pre>
        <h2>Test your connection</h2>
        <ol>
            <li>Ensure your MongoDB database is configured. See <a href="https://www.mongodb.com/docs/manual/installation/">Install MongoDB</a> for more information.</li>
            <li>
                <MadCap:snippetText src="../../Z_Resources/Snippets/text/database-tutorials/database-properties-url.flsnp" />
            </li><pre xml:space="preserve"><code class="language-html">url: mongodb://hostname:27017/myDatabase</code></pre>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">If you are unsure about how to configure the <code>url</code> property, refer to <a href="https://docs.mongodb.com/manual/reference/connection-string/">Connection String URI Format</a>.</p>
            <MadCap:snippetBlock src="../../Z_Resources/Snippets/note/database-license-key.flsnp" />
        </ol>
        <MadCap:snippetBlock src="../../Z_Resources/Snippets/text/database-tutorials/database-changelog-test-connection.flsnp" MadCap:conditionTagExpression="include[database.mongodb]" />
        <h2>Related links</h2>
        <ul>
            <li>
                <MadCap:xref href="mongodb-pro-user-roles.htm">MongoDB Pro Extension User Roles</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="mongodb-pro-amazon-documentdb.htm">MongoDB Pro and Amazon DocumentDB</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="mongodb-pro-aws-doc-config.htm">MongoDB Pro and Amazon DocumentDB TLS/SSL&#160;Configuration</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="mongo-db-atlas-config.htm">MongoDB Atlas</MadCap:xref>
            </li>
            <li><a href="https://contribute.liquibase.com/extensions-integrations/directory/tutorials/mongodb/">Contributor Docs:&#160;Open Source MongoDB Extension</a>
            </li>
        </ul>
    </body>
</html>